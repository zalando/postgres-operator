FROM golang:1.22
LABEL maintainer="Team ACID @ Zalando <team-acid@zalando.de>"

ENV DEBIAN_FRONTEND=noninteractive

# We need root certificates to deal with teams api over https
RUN apt update && apt install -y ca-certificates delve

COPY build/* /

RUN addgroup -g 1000 pgo
RUN adduser -D -u 1000 -G pgo -g 'Postgres Operator' pgo

USER pgo:pgo
RUN ls -l /

CMD ["/dlv", "--listen=:7777", "--headless=true", "--api-version=2", "exec", "/postgres-operator"]
